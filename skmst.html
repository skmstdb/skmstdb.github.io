<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6C7BJGKMFT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-6C7BJGKMFT');
    </script>
    <meta charset="UTF-8">
    <script src="js/visibility.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="堺雅人の出演作品と、各動画配信サービスでの視聴方法を一覧で紹介。映画やドラマをどこでオンライン視聴できるか、詳細な情報をチェック！ / Explore Sakai Masato's works and where to watch them on streaming services. Find out where to watch his movies and dramas online.">
    <meta name="keywords"
        content="堺雅人, 出演作品, 映画, テレビドラマ, 動画配信サービス, データベース, Sakai Masato, Film, Movie, TV, Shows, Series, Database">
    <title>Sakai Masato Database</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="icon" href="favicon-32x32.png" sizes="32x32" />
    <link rel="apple-touch-icon" href="../pic/apple-touch-icon.png">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="Navi/navi.css">
    <script src="js/darkmode.js"></script>
    <script src="Navi/navHighlight.js"></script>
    <script src="js/jst-utils.js"></script>

    <!-- Google Fonts: Noto Serif JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700;900&display=swap"
        rel="stylesheet">


    <style>
        :root {
            /* Fallback/Local variables matching style.css */
            --bg-color: #f6f4ef;
            --text-color: #333333;

            /* New variables for Progress Panel */
            --panel-bg: #ffffff;
            --bar-bg: #e0e0e0;
            --bar-fill: #333333;
            --bar-text: #ffffff;
        }

        .dark-mode {
            /* Matches style.css */
            --bg-color: #121212;
            --text-color: #ffffff;

            /* Dark mode for Progress Panel */
            --panel-bg: #1e1e1e;
            --bar-bg: #444444;
            --bar-fill: #e0e0e0;
            --bar-text: #1a1a1a;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
        }

        body {
            display: flex;
            flex-direction: row;
        }

        .sidebar {
            width: calc(100% / 7);
            /* 占据1/7的宽度 */
            height: 100vh;
            overflow-y: auto;
            position: relative;
            z-index: 10;
            flex-shrink: 0;
            box-sizing: border-box;
            background: var(--bg-color);
            border-right: 1px solid var(--bar-bg);
        }

        .notion-container {
            width: calc(6 * 100% / 7);
            height: 100vh;
            position: relative;
            z-index: 5;
            box-sizing: border-box;
            margin-left: auto;
        }

        .notion-view {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .notion-view iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Progress tiles within grid */
        .progress-tile {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /* Center content for rings */
        }

        /* Force all progress tiles to display in the first row */
        .progress-tile.sakai {
            grid-column: span 2;
            /* Span 2 cols - horizontal rectangle */
            grid-row: span 1;
        }

        .progress-tile.now {
            grid-column: span 4;
            /* Span 4 cols - horizontal rectangle */
            grid-row: span 1;
        }

        .progress-tile.running {
            grid-column: span 1;
            /* Span 1 col */
            grid-row: span 1;
        }

        .progress-section {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .progress-title {
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 0;
            color: #333;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            text-align: left;
            padding-left: 5px;
            padding-top: 0px;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .progress-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            height: 100%;
            align-items: center;
            justify-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Sakai tile uses horizontal layout (2 columns) */
        .progress-tile.sakai .progress-grid {
            grid-template-columns: 1fr 1fr;
        }

        /* Now tile uses horizontal layout */
        .progress-tile.now .progress-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        .progress-item-ring {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .progress-ring-container {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .progress-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring-circle-bg {
            fill: transparent;
            stroke: var(--bar-bg);
            stroke-width: 8;
        }

        .progress-ring-circle-fill {
            fill: transparent;
            stroke: var(--bar-fill);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 226.19;
            /* 2 * PI * 36 */
            stroke-dashoffset: 226.19;
            transition: stroke-dashoffset 1s ease-in-out;
        }

        .progress-text-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            font-weight: bold;
            color: var(--text-color);
        }

        .progress-label-bottom {
            margin-top: 8px;
            font-size: 0.75rem;
            font-weight: 500;
            color: #666;
            text-align: center;
        }

        .uptime-counter {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            white-space: nowrap;
        }

        .uptime-label {
            font-size: 0.75rem;
            color: #999;
            margin-bottom: 8px;
            text-align: center;
        }

        /* Running Tile Specifics */
        .progress-tile.running {
            position: relative;
            /* Ensure absolute positioning works relative to this */
        }

        .progress-tile.running .progress-section {
            align-items: flex-start;
            /* Title stays top-left */
        }

        .progress-tile.running .uptime-label {
            position: absolute;
            bottom: 0.1px;
            right: 0.1px;
            margin: 0;
            text-align: right;
            width: auto;
        }

        /* 确保主容器不会被其他样式覆盖 */
        #main-container {
            display: flex;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Showcase View Styles (Carl Hauser Masonry Grid) --- */
        #showcase-container {
            background-color: #f6f4ef;
            ;
            color: #333;
            padding: 40px;
            overflow-y: auto;
            box-sizing: border-box;
            height: 100vh;
        }

        .showcase-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            grid-auto-rows: 180px;
            gap: 15px;
            width: 100%;
            grid-auto-flow: dense;
            /* Fill gaps automatically */
        }

        .showcase-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            /* Rounded corners */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 20px;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        /* Size variations based on work type */
        .showcase-item[data-type*="映画"] {
            grid-column: span 2;
            grid-row: span 1;
        }

        .showcase-item[data-type*="TV"] {
            grid-column: span 1;
            grid-row: span 2;
        }

        .showcase-item[data-type*="舞台"],
        .showcase-item[data-type*="その他"],
        .showcase-item[data-type*="声の出演"] {
            grid-column: span 1;
            grid-row: span 1;
        }

        /* Multi-year works always display as 2x2 (4 cells) */
        .showcase-item[data-multi-year="true"] {
            grid-column: span 2 !important;
            grid-row: span 2 !important;
        }

        /* Recent works (within 30 days of start/end or active) override all sizes */
        .showcase-item[data-recent="true"] {
            grid-column: span 2 !important;
            grid-row: span 3 !important;
        }

        .showcase-item:hover {
            background-color: #fafafa;
            border-color: #999;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .showcase-content {
            text-align: center;
            width: 100%;
        }

        .showcase-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1.3;
            color: #222;
            margin-bottom: 8px;
        }

        .showcase-item[data-type*="映画"] .showcase-title {
            font-size: 1.8rem;
        }

        /* Vertical text for items where col span < row span 纵向文字 */
        .showcase-item.vertical-text .showcase-title {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.1em;
            margin: 0 auto 8px auto;
            /* Center horizontally */
        }

        .showcase-meta {
            font-size: 0.75rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Dark mode adaptations */
        .dark-mode #showcase-container {
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .dark-mode .progress-tile {
            background-color: var(--panel-bg);
            border-color: var(--bar-bg);
        }

        .dark-mode .progress-title {
            color: var(--text-color);
        }

        .dark-mode .showcase-item {
            background-color: var(--panel-bg);
            border-color: var(--bar-bg);
        }

        .dark-mode .showcase-item:hover {
            background-color: #2a2a2a;
            border-color: #666;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
        }

        .dark-mode .showcase-title {
            color: var(--text-color);
        }

        .dark-mode .showcase-meta {
            color: #888;
        }

        .dark-mode .uptime-counter {
            color: var(--text-color);
        }


        /* Mobile adjustments */
        @media screen and (max-width: 768px) {

            html,
            body {
                overflow-y: auto;
                height: auto;
            }

            body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                min-height: 60px;
                position: fixed;
                top: 0;
                left: 0;
                z-index: 100;
                border-right: none;
                border-bottom: 1px solid var(--bar-bg);
            }

            #main-container {
                height: auto;
                overflow: visible;
                display: block;
            }

            .notion-container {
                width: 100%;
                height: auto;
                min-height: 100vh;
                margin-left: 0;
                padding-top: 60px;
                flex-direction: column;
                overflow: visible;
            }

            .notion-view {
                flex: none;
                height: 60vh;
                border-right: none;
            }

            .progress-panel {
                flex: none;
                height: auto;
                padding: 20px;
                overflow: visible;
            }

            /* Fix showcase grid to ensure equal column widths */
            .showcase-list {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: minmax(150px, auto);
                gap: 10px;
            }

            /* Reset progress tiles for mobile */
            .progress-tile.sakai,
            .progress-tile.running {
                grid-column: span 2 !important;
                grid-row: span 1 !important;
            }

            .progress-tile.now {
                grid-column: span 2 !important;
                grid-row: span 2 !important;
                /* Needs more height for 2x2 grid */
            }

            /* Adjust Now tile internal grid for mobile to fit */
            .progress-tile.now .progress-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            /* Force recent works to span 2 columns on mobile (instead of 3) */
            .showcase-item[data-recent="true"] {
                grid-column: span 2 !important;
                grid-row: span 2 !important;
                /* Adjust row span as needed, 2 is likely good */
            }
        }

        /* Intermediate Breakpoint: When grid has ~3 columns (approx 769px to 1024px) */
        /* "Now" tile (span 4) won't fit in 3 columns, so reduce it to span 3 */
        @media screen and (min-width: 769px) and (max-width: 1024px) {
            .progress-tile.now {
                grid-column: span 3 !important;
                /* Keep row span 1 */
            }

            /* Internal grid still 4 columns, they will just be closer together */
        }
    </style>
</head>

<body>
    <div id="main-container">
        <aside class="sidebar">
            <!-- Navbar content will be loaded here -->
        </aside>

        <div class="notion-container">
            <div class="notion-view" id="showcase-container">
                <div class="showcase-list" id="showcase-list">
                    <!-- Showcase items will be injected here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 確保ページロード後に正確にレイアウトを適用
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize Showcase
            initShowcase();

            // Update every minute
            setInterval(updateProgressBars, 60000);
        });

        function updateProgressBars() {
            const now = getJSTNow();
            const year = now.getFullYear();
            const month = now.getMonth(); // 0-11

            // 1. Decade Progress (2020-2029)
            const startOfDecade = new Date(Math.floor(year / 10) * 10, 0, 1);
            const endOfDecade = new Date((Math.floor(year / 10) + 1) * 10, 0, 1);
            const decadeProgress = (now - startOfDecade) / (endOfDecade - startOfDecade) * 100;
            updateBar('decade', decadeProgress);
            document.getElementById('decade-label').textContent = `${Math.floor(year / 10) * 10}s`;

            // 2. Year Progress
            const startOfYear = new Date(year, 0, 1);
            const endOfYear = new Date(year + 1, 0, 1);
            const yearProgress = (now - startOfYear) / (endOfYear - startOfYear) * 100;
            updateBar('year', yearProgress);
            document.getElementById('year-label').textContent = `${year}`;

            // 3. Quarter Progress
            const quarter = Math.floor(month / 3);
            const startOfQuarter = new Date(year, quarter * 3, 1);
            const endOfQuarter = new Date(year, (quarter + 1) * 3, 1);
            const quarterProgress = (now - startOfQuarter) / (endOfQuarter - startOfQuarter) * 100;
            updateBar('quarter', quarterProgress);
            document.getElementById('quarter-label').textContent = `Q${quarter + 1}`;

            // 4. Month Progress
            const startOfMonth = new Date(year, month, 1);
            const endOfMonth = new Date(year, month + 1, 1);
            const monthProgress = (now - startOfMonth) / (endOfMonth - startOfMonth) * 100;
            updateBar('month', monthProgress);
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"
            ];
            document.getElementById('month-label').textContent = `${monthNames[month]}`;

            // 5. Sakai Masato Age Progress
            // Born: 1973-10-14
            const birthMonth = 9; // October (0-indexed)
            const birthDay = 14;

            // Calculate current age
            let age = year - 1973;
            if (month < birthMonth || (month === birthMonth && now.getDate() < birthDay)) {
                age--;
            }

            let lastBirthday = new Date(year, birthMonth, birthDay);
            let nextBirthday = new Date(year + 1, birthMonth, birthDay);

            if (now < lastBirthday) {
                lastBirthday = new Date(year - 1, birthMonth, birthDay);
                nextBirthday = new Date(year, birthMonth, birthDay);
            }

            const ageProgress = (now - lastBirthday) / (nextBirthday - lastBirthday) * 100;
            updateBar('age', ageProgress);
            document.getElementById('age-label').textContent = `${age}`;

            // 6. 50s Decade Progress (or whatever decade he is in)
            // Born 1973. 
            // 50s: 50-59. Starts at 50th birthday, ends at 60th birthday.
            const currentDecadeStartAge = Math.floor(age / 10) * 10;
            const currentDecadeEndAge = currentDecadeStartAge + 10;

            const decadeStartBirthday = new Date(1973 + currentDecadeStartAge, birthMonth, birthDay);
            const decadeEndBirthday = new Date(1973 + currentDecadeEndAge, birthMonth, birthDay);

            const lifeDecadeProgress = (now - decadeStartBirthday) / (decadeEndBirthday - decadeStartBirthday) * 100;
            updateBar('life-decade', lifeDecadeProgress);
            document.getElementById('life-decade-label').textContent = `${currentDecadeStartAge}s`;

            // 7. Website Uptime
            // Launched: 2025-02-27 (JST)
            const launchDate = createJSTDate(2025, 1, 27); // Feb is 1 (0-indexed)
            const diffTime = Math.abs(now - launchDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('uptime-days').textContent = `${diffDays} Days`;
        }

        function updateBar(idPrefix, percentage) {
            const circle = document.getElementById(`${idPrefix}-bar`);
            const text = document.getElementById(`${idPrefix}-percent`);

            // Clamp percentage between 0 and 100
            const clampedPercentage = Math.min(Math.max(percentage, 0), 100);

            // Circumference = 2 * PI * 36 = 226.19
            const circumference = 226.19;
            const offset = circumference - (clampedPercentage / 100) * circumference;

            if (circle) circle.style.strokeDashoffset = offset;
            // No decimal places
            if (text) text.textContent = `${Math.floor(clampedPercentage)}%`;
        }

        // --- Showcase Logic ---

        async function initShowcase() {
            const works = await fetchWorks();
            if (works.length === 0) return;
            renderShowcase('showcase-list', works);
        }

        async function fetchWorks() {
            try {
                const response = await fetch('/data/biography.csv');
                const data = await response.text();
                const rows = data.split('\n').slice(1); // Skip header
                const today = getJSTNow();
                today.setHours(0, 0, 0, 0); // Reset time to midnight for date comparison

                const works = rows
                    .map(row => {
                        // Handle CSV with potential commas in quoted fields
                        const cols = [];
                        let current = '';
                        let inQuotes = false;

                        for (let i = 0; i < row.length; i++) {
                            const char = row[i];
                            if (char === '"') {
                                inQuotes = !inQuotes;
                            } else if (char === ',' && !inQuotes) {
                                cols.push(current.trim());
                                current = '';
                            } else {
                                current += char;
                            }
                        }
                        cols.push(current.trim()); // Push last column

                        if (cols.length < 16) return null;

                        // CSV Structure: PageWorks,PageActivity,PageToday,PageCalendar,PageAnn,Year,Name,Title,Role,WorksType,DateStart,DateEnd,Weekday,DateAdd,DateDelete,URL
                        // Indices:        0         1            2         3            4      5    6    7     8    9         10        11      12      13      14         15

                        const dateStartStr = cols[10];
                        let dateStart = null;
                        if (dateStartStr && dateStartStr.trim() !== '') {
                            // Parse date in format YYYY/MM/DD as JST
                            dateStart = parseJSTDate(dateStartStr);
                        }

                        const dateEndStr = cols[11];
                        let dateEnd = null;
                        if (dateEndStr && dateEndStr.trim() !== '') {
                            // Parse date in format YYYY/MM/DD as JST
                            dateEnd = parseJSTDate(dateEndStr);
                        }

                        return {
                            year: parseInt(cols[5]) || 0,
                            name: cols[6],
                            title: cols[7],
                            role: cols[8],
                            type: cols[9],
                            dateStart: dateStart,
                            dateEnd: dateEnd,
                            url: cols[15], // URL is at index 15
                            isLead: (cols[8] && cols[8].includes('主演'))
                        };
                    })
                    // Filter for Lead roles, valid names, and Year 
                    .filter(work => {
                        if (!work || !work.name || work.name.trim() === '' || !work.isLead) {
                            return false;
                        }
                        // Must have Year
                        if (!work.year || work.year === 0) return false;
                        return true;
                    });

                // Group by Name
                const nameGroups = new Map();
                for (const work of works) {
                    if (!nameGroups.has(work.name)) {
                        nameGroups.set(work.name, []);
                    }
                    nameGroups.get(work.name).push(work);
                }

                // Consolidate each name group
                const consolidatedWorks = [];
                for (const [name, worksInGroup] of nameGroups) {
                    // Sort by dateStart to find the earliest
                    worksInGroup.sort((a, b) => a.dateStart - b.dateStart);

                    // Use the earliest work's type for grid sizing
                    const earliestWork = worksInGroup[0];

                    // Calculate min DateStart and max DateEnd
                    let minDateStart = null;
                    let maxDateEnd = null;

                    worksInGroup.forEach(w => {
                        if (w.dateStart) {
                            if (!minDateStart || w.dateStart < minDateStart) minDateStart = w.dateStart;
                        }
                        if (w.dateEnd) {
                            if (!maxDateEnd || w.dateEnd > maxDateEnd) maxDateEnd = w.dateEnd;
                        }
                    });

                    // Collect unique years
                    const uniqueYears = [...new Set(worksInGroup.map(w => w.year))].sort((a, b) => a - b);

                    // Use the earliest work's URL (or could use the most recent, depending on preference)
                    consolidatedWorks.push({
                        name: name,
                        year: Math.max(...uniqueYears), // Use the latest year for sorting
                        years: uniqueYears.join(' '),
                        type: earliestWork.type,
                        url: earliestWork.url,
                        dateStart: minDateStart,
                        dateEnd: maxDateEnd
                    });
                }

                // Sort by Year Descending, then by DateStart Descending
                return consolidatedWorks.sort((a, b) => {
                    // First, sort by year (most recent first)
                    if (b.year !== a.year) {
                        return b.year - a.year;
                    }
                    // If years are the same, sort by DateStart (most recent first)
                    // Handle cases where DateStart might be null
                    if (!a.dateStart && !b.dateStart) return 0;
                    if (!a.dateStart) return 1; // Put items without dateStart at the end
                    if (!b.dateStart) return -1;
                    return b.dateStart - a.dateStart;
                });
            } catch (error) {
                console.error('Error fetching works:', error);
                return [];
            }
        }

        function renderShowcase(containerId, works) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            // 1. Render Progress Tiles First
            renderProgressTiles(container);

            // 2. Render Works
            works.forEach((work, index) => {
                const item = document.createElement('div');
                item.className = 'showcase-item';
                item.setAttribute('data-type', work.type || 'その他');

                // Check if work spans multiple years
                const yearCount = work.years.split(' ').length;
                if (yearCount > 1) {
                    item.setAttribute('data-multi-year', 'true');
                }

                // Check if work is recent (within 30 days of start/end or active)
                // Criteria:
                // 1. |Today - DateStart| <= 30 days
                // 2. |Today - DateEnd| <= 30 days
                // 3. DateStart <= Today <= DateEnd
                // Effectively: DateStart - 30 <= Today <= DateEnd + 30

                let isRecent = false;
                if (work.dateStart) {
                    const today = getJSTNow();
                    today.setHours(0, 0, 0, 0);

                    const startLimit = new Date(work.dateStart);
                    startLimit.setDate(startLimit.getDate() - 30);

                    // If dateEnd is missing, assume it's just a start date event (like a movie release)
                    // So we check if today is within 30 days of start
                    let endLimit = new Date(work.dateEnd || work.dateStart);
                    endLimit.setDate(endLimit.getDate() + 30);

                    if (today >= startLimit && today <= endLimit) {
                        isRecent = true;
                        item.setAttribute('data-recent', 'true');
                    }
                }

                // Content Wrapper
                const content = document.createElement('div');
                content.className = 'showcase-content';

                const title = document.createElement('div');
                title.className = 'showcase-title';
                title.textContent = work.name;

                const meta = document.createElement('div');
                meta.className = 'showcase-meta';
                meta.textContent = work.years;

                content.appendChild(title);
                content.appendChild(meta);
                item.appendChild(content);

                // Click to navigate to URL or search
                item.onclick = () => {
                    if (work.url && work.url.trim() !== '') {
                        window.open(work.url, '_blank');
                    } else {
                        window.open(`https://www.google.com/search?q=堺雅人 ${work.name}`, '_blank');
                    }
                };

                container.appendChild(item);

                // Dynamic Check: Apply vertical text if rowSpan > colSpan
                // Must be done AFTER appending to DOM to get computed styles
                const style = window.getComputedStyle(item);

                const getSpanFromProp = (prop) => {
                    const val = style[prop];
                    if (!val) return 0;
                    const match = val.match(/span\s+(\d+)/);
                    return match ? parseInt(match[1]) : 0;
                };

                // Check both start and end for 'span'
                const colSpan = Math.max(getSpanFromProp('gridColumnStart'), getSpanFromProp('gridColumnEnd'), 1);
                const rowSpan = Math.max(getSpanFromProp('gridRowStart'), getSpanFromProp('gridRowEnd'), 1);

                if (rowSpan > colSpan) {
                    item.classList.add('vertical-text');
                }
            });


            // Update progress bars after rendering
            updateProgressBars();
        }

        function renderProgressTiles(container) {
            // Helper to create ring HTML
            const createRing = (idPrefix, label) => `
                <div class="progress-item-ring">
                    <div class="progress-ring-container">
                        <svg class="progress-ring" width="80" height="80">
                            <circle class="progress-ring-circle-bg" cx="40" cy="40" r="36"></circle>
                            <circle class="progress-ring-circle-fill" id="${idPrefix}-bar" cx="40" cy="40" r="36"></circle>
                        </svg>
                        <div class="progress-text-center" id="${idPrefix}-percent">0%</div>
                    </div>
                    <div class="progress-label-bottom" id="${idPrefix}-label">${label}</div>
                </div>
            `;

            // Sakai Tile (2x1)
            const sakaiTile = document.createElement('div');
            sakaiTile.className = 'progress-tile sakai';
            sakaiTile.innerHTML = `
                <div class="progress-section">
                    <div class="progress-title">堺さん</div>
                    <div class="progress-grid">
                        ${createRing('age', 'Age')}
                        ${createRing('life-decade', 'Decade')}
                    </div>
                </div>
            `;
            container.appendChild(sakaiTile);

            // Now Tile (2x2)
            const nowTile = document.createElement('div');
            nowTile.className = 'progress-tile now';
            nowTile.innerHTML = `
                <div class="progress-section">
                    <div class="progress-title">Now</div>
                    <div class="progress-grid">
                        ${createRing('decade', 'Decade')}
                        ${createRing('year', 'Year')}
                        ${createRing('quarter', 'Quarter')}
                        ${createRing('month', 'Month')}
                    </div>
                </div>
            `;
            container.appendChild(nowTile);

            // Running Tile (1x1)
            const runningTile = document.createElement('div');
            runningTile.className = 'progress-tile running';
            runningTile.innerHTML = `
                <div class="progress-section">
                    <div class="progress-title">Running</div>
                    <div class="uptime-label">Since 2025.02.27</div>
                    <div class="uptime-counter" id="uptime-days">0 Days</div>
                </div>
            `;
            container.appendChild(runningTile);
        }
    </script>
</body>

</html>
